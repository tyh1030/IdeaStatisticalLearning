### 注意
- PostgreSQL物件有區分大小寫，為加速教學使用，以下範例都以小寫符號進行(包含建立物件及操控物件)
### 建立資料庫(Database)
``` sql
DROP DATABASE IF exists db_iot;
CREATE DATABASE db_iot;
```
### 建立資料表(Tables)
1. 公司資料表(Company)
 ``` sql
-- create the table schema
CREATE TABLE company(
	company_id varchar(20) NOT NULL,
	company_name varchar(50) NOT NULL,
	CONSTRAINT pk_company PRIMARY KEY (company_id)
);
-- insert a default row
INSERT INTO company VALUES ('12345678','勤勞科技股份有限公司');
```
1. 廠區資料表(Factory)
``` sql
-- create the table schema
CREATE TABLE factory(
	company_id varchar(20) NOT NULL,
	factory_id varchar(20) NOT NULL,
	factory_name varchar(50) NOT NULL,
	CONSTRAINT pk_factory primary key (company_id,factory_id)
);
-- set the foreign key
ALTER TABLE factory ADD CONSTRAINT FK_factory_company_id FOREIGN KEY (company_id) REFERENCES company(company_id) ON UPDATE CASCADE ON DELETE RESTRICT; 
-- insert a default row
INSERT INTO factory VALUES ('12345678','88016868','太平廠');
```
1. 資產資料表
``` sql
-- create the table schema
CREATE TABLE asset(
	company_id varchar(20) NOT NULL,
	factory_id varchar(20) NOT NULL,
	asset_id varchar(10) NOT NULL,
	asset_name varchar(50) NOT NULL,
	CONSTRAINT pk_asset PRIMARY KEY (company_id,factory_id,asset_id)
);
-- set the foreign key
ALTER TABLE asset ADD CONSTRAINT FK_asset_factory_id FOREIGN KEY (company_id,factory_id) REFERENCES factory(company_id,factory_id) ON UPDATE CASCADE ON DELETE RESTRICT; 
-- insert a default row
INSERT INTO asset VALUES ('12345678','88016868','101-H35','冷凍式空氣乾燥機');
INSERT INTO asset VALUES ('12345678','88016868','102-H23','冷凍式空氣乾燥機');
INSERT INTO asset VALUES ('12345678','88016868','104-F13','變頻螺旋式空壓機');
INSERT INTO asset VALUES ('12345678','88016868','103-B76','溫水清洗機');
```
1. IoT設備資料表
``` sql
-- create the table schema
CREATE TABLE equipment(
	equip_model varchar(10) NOT NULL,
	equip_name varchar(50) NOT NULL,
	CONSTRAINT pk_equipment PRIMARY KEY (equip_model)
);
-- insert a default row
INSERT INTO equipment VALUES ('DPM-C530','多功能集合電表');
```
1. IoT屬性資料表
``` sql
-- create the table schema
CREATE TABLE instrument(
	equip_model varchar(10) NOT NULL,
	instr_model varchar(10) NOT NULL,
	instr_name varchar(50) NOT NULL,
	CONSTRAINT pk_instrument PRIMARY KEY (equip_model,instr_model)
);
-- set the foreign key
ALTER TABLE instrument ADD CONSTRAINT FK_instrument_equip_model FOREIGN KEY (equip_model) REFERENCES equipment(equip_model) ON UPDATE CASCADE ON DELETE RESTRICT; 
-- insert a default row
INSERT INTO instrument VALUES ('DPM-C530','V257','電壓');
INSERT INTO instrument VALUES ('DPM-C530','I295','電流');
INSERT INTO instrument VALUES ('DPM-C530','F323','頻率');
INSERT INTO instrument VALUES ('DPM-C530','P325','實功功率');
INSERT INTO instrument VALUES ('DPM-C530','W349','實功電能');
```
1. IoT資料採集資料表
``` sql
-- create the table schema
CREATE TABLE iotrawdata(
	company_id varchar(20) NOT NULL,
	factory_id varchar(20) NOT NULL,
	asset_id varchar(10) NOT NULL,
	equip_model varchar(10) NOT NULL,
	instr_model varchar(10) NOT NULL,
	createtime timestamp without time zone NOT NULL,
	rawvalue numeric(18,4) NULL,
	CONSTRAINT pk_iotrawdata PRIMARY KEY (company_id,factory_id,asset_id,equip_model,instr_model,createtime)
);
-- set the foreign key
-- fk1
ALTER TABLE iotrawdata ADD CONSTRAINT FK_iotrawdata_asset_id FOREIGN KEY (company_id,factory_id,asset_id) REFERENCES asset(company_id,factory_id,asset_id) ON UPDATE CASCADE ON DELETE RESTRICT; 
-- fk2
ALTER TABLE iotrawdata ADD CONSTRAINT FK_iotrawdata_instr_model FOREIGN KEY (equip_model,instr_model) REFERENCES instrument(equip_model,instr_model) ON UPDATE CASCADE ON DELETE RESTRICT; 
```

### 建立檢視表(Views)